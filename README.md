# DAO Earn Series (USD based - 9 products)

DAO Earn vault series utilize Curve and Convex protocols to get APY. In high-level, DAO Earn do compounding by sell $CRV, $CVX, and any extra reward from Curve pool to buy more LP token and stake into Convex again.

### Deposit token:-

Product Name | Available token to deposit
--------- | --------------------------
LUSD | USDT/USDC/DAI/[LUSD](https://etherscan.io/address/0x5f98805A4E8be255a32880FDeC7F6728C6568bA0)/*[LP Token](https://etherscan.io/address/0xEd279fDD11cA84bEef15AF5D39BB4d4bEE23F0cA)/[3Crv](https://etherscan.io/address/0x6c3F90f043a72FA612cbac8115EE7e52BDe6E490)/**any token/directly from ETH
BUSDv2 | USDT/USDC/DAI/[BUSD](https://etherscan.io/address/0x4Fabb145d64652a948d72533023f6E7A623C7C53)/*[LP Token](https://etherscan.io/address/0x4807862AA8b2bF68830e4C8dc86D0e9A998e085a)/3Crv/**any token/directly from ETH
alUSD | USDT/USDC/DAI/[alUSD](https://etherscan.io/address/0xBC6DA0FE9aD5f3b0d58160288917AA56653660E9)/*[LP Token](https://etherscan.io/address/0x43b4FdFD4Ff969587185cDB6f0BD875c5Fc83f8c)/3Crv/**any token/directly from ETH
UST | USDT/USDC/DAI/[UST](https://etherscan.io/address/0xa47c8bf37f92aBed4A126BDA807A7b7498661acD)/*[LP Token](https://etherscan.io/address/0x94e131324b6054c0D789b190b2dAC504e4361b53)/3Crv/**any token/directly from ETH
USDN | USDT/USDC/DAI/[USDN](https://etherscan.io/address/0x674C6Ad92Fd080e4004b2312b45f796a192D27a0)/*[LP Token](https://etherscan.io/address/0x4f3E8F405CF5aFC05D68142F3783bDfE13811522)/3Crv/**any token/directly from ETH
sUSD | USDT/USDC/DAI/[sUSD](https://etherscan.io/address/0x57Ab1ec28D129707052df4dF418D58a2D46d5f51)/*[LP Token](https://etherscan.io/address/0xC25a3A3b969415c80451098fa907EC722572917F)/**any token/directly from ETH
Yearn | USDT/USDC/DAI/[TUSD](https://etherscan.io/address/0x0000000000085d4780B73119b644AE5ecd22b376)/[yUSDT](https://etherscan.io/address/0x83f798e925BcD4017Eb265844FDDAbb448f1707D)/[yUSDC](https://etherscan.io/address/0xd6aD7a6750A7593E092a9B218d66C0A814a3436e)/[yDAI](https://etherscan.io/address/0x16de59092dAE5CcF4A1E6439D611fd0653f0Bd01)/[yTUSD](https://etherscan.io/address/0x73a052500105205d34Daf004eAb301916DA8190f)/*[LP Token](https://etherscan.io/address/0xdF5e0e81Dff6FAF3A7e52BA697820c5e32D806A8)/**any token/directly from ETH
AAVE | USDT/USDC/DAI/[aUSDT](https://etherscan.io/address/0x3Ed3B47Dd13EC9a98b44e6204A523E766B225811)/[aUSDC](https://etherscan.io/address/0xBcca60bB61934080951369a648Fb03DF4F96263C)/[aDAI](https://etherscan.io/address/0x028171bCA77440897B824Ca71D1c56caC55b68A3)/*[LP Token](https://etherscan.io/address/0xFd2a8fA60Abd58Efe3EeE34dd494cD491dC14900)/**any token/directly from ETH
sAAVE | [sUSD](https://etherscan.io/address/0x57Ab1ec28D129707052df4dF418D58a2D46d5f51)/DAI/[aSUSD](https://etherscan.io/address/0x6C5024Cd4F8A59110119C56f8933403A539555EB)/[aDAI](https://etherscan.io/address/0x028171bCA77440897B824Ca71D1c56caC55b68A3)/*[LP Token](https://etherscan.io/address/0x02d341CcB60fAaf662bC0554d13778015d1b285C)/**any token/directly from ETH

*Deposit LP token for no slippage & fees by Curve

*any token that available to swap in Sushi.

### Withdraw token:-

Product Name | Available token to withdraw
--------- | --------------------------
LUSD | USDT/USDC/DAI/[LUSD](https://etherscan.io/address/0x5f98805A4E8be255a32880FDeC7F6728C6568bA0)/*[LP Token](https://etherscan.io/address/0xEd279fDD11cA84bEef15AF5D39BB4d4bEE23F0cA)
BUSDv2 | USDT/USDC/DAI/[BUSD](https://etherscan.io/address/0x4Fabb145d64652a948d72533023f6E7A623C7C53)/*[LP Token](https://etherscan.io/address/0x4807862AA8b2bF68830e4C8dc86D0e9A998e085a)
alUSD | USDT/USDC/DAI/[alUSD](https://etherscan.io/address/0xBC6DA0FE9aD5f3b0d58160288917AA56653660E9)/*[LP Token](https://etherscan.io/address/0x43b4FdFD4Ff969587185cDB6f0BD875c5Fc83f8c)
UST | USDT/USDC/DAI/[UST](https://etherscan.io/address/0xa47c8bf37f92aBed4A126BDA807A7b7498661acD)/*[LP Token](https://etherscan.io/address/0x94e131324b6054c0D789b190b2dAC504e4361b53)
USDN | USDT/USDC/DAI/[USDN](https://etherscan.io/address/0x674C6Ad92Fd080e4004b2312b45f796a192D27a0)/*[LP Token](https://etherscan.io/address/0x4f3E8F405CF5aFC05D68142F3783bDfE13811522)
sUSD | USDT/USDC/DAI/[sUSD](https://etherscan.io/address/0x57Ab1ec28D129707052df4dF418D58a2D46d5f51)/*[LP Token](https://etherscan.io/address/0xC25a3A3b969415c80451098fa907EC722572917F)
Yearn | USDT/USDC/DAI/[TUSD](https://etherscan.io/address/0x0000000000085d4780B73119b644AE5ecd22b376)/*[LP Token](https://etherscan.io/address/0xdF5e0e81Dff6FAF3A7e52BA697820c5e32D806A8)
AAVE | USDT/USDC/DAI/*[LP Token](https://etherscan.io/address/0xdF5e0e81Dff6FAF3A7e52BA697820c5e32D806A8)
sAAVE | [sUSD](https://etherscan.io/address/0x57Ab1ec28D129707052df4dF418D58a2D46d5f51)/DAI/*[LP Token](https://etherscan.io/address/0x02d341CcB60fAaf662bC0554d13778015d1b285C)

*Withdraw LP token for no slippage & fees by Curve

# Developer docs

Each DAO Earn pool consist of 3 contracts: **vault**, **strategy**, and **zap**.

**Vault** is the proxy contract to keep and invest LP token into strategy.

**Strategy** is the contract to invest and compound LP token in Convex.

**Zap** is the contract to swap token other than LP and deposit into vault.

## Frontend

Example with Ethers.js

### Deposit

LP token: (through **vault** proxy contract)
```javascript
lpToken.approve(vault.address, ethers.constants.MaxUint256)
vault.deposit(amountOfLpToken, trueOrFalse)
```

USDT/USDC/DAI/Base coin/3Crv: (through **zap** contract)
```javascript
coin.approve(zap.address, ethers.constants.MaxUint256)
zap.deposit(vault.address, amountOfCoin, coin.address, trueOrFalse)
```

Any available token on Sushi: (through **zap** contract)
```javascript
token.approve(zap.address, ethers.constants.MaxUint256)
zap.depositZap(vault.address, amountOfToken, token.address, trueOrFalse)
```
To Check token availability, use `checkTokenSwapAvailability()` function in zap contract. Return amount in USD, return 0 if token not availability.
```javascript
zap.checkTokenSwapAvailability(amountInput, tokenInput, tokenOutput)
```

Directly from ETH: (through **zap** contract, `amountOfETH` in 18 decimals)
```javascript
zap.depositZap(vault.address, amountOfETH, ethers.constants.AddressZero, trueOrFalse, {from: client.address, value: amountOfETH})
```
> `trueOfFalse` is a boolean to stake daoERN into DAOmine directly.

### Withdraw

LP token: (through **vault** proxy contract)
```javascript
vault.withdraw(amountOfShares)
```
USDT/USDC/DAI/Base coin: (through **zap** contract)
```javascript
zap.withdraw(vault.address, amountOfShares, coin.address)
```

## Backend

[Formula to calculate APY](https://docs.google.com/document/d/1E4xEBG7COtlIvleQWoh26PcvIkpFxgOUpmk9BXJsv8s/edit#heading=h.suss79bdwa4r)

## Deployer

1/ Base contracts

Run script for everything in scripts/deploy/usd/base folder.

Record down every contract address that deployed for later use. (will show with console.log after success deploy)

For each deploy script in deploy/usd/base folder, there is a verify script in verify/usd/base folder with same script name.
```
npx hardhat run --network mainnet scripts/deploy/usd/base/curveLendingPool2Zap.js
npx hardhat run --network mainnet scripts/verify/usd/base/curveLendingPool2Zap.js
```

2/ Product contracts

Run every script in scripts/deploy/usd/products folder. Fill in `earnStrategyFactoryAddr`, `earnStrategyTemplateAddr` and `curveZapAddr` with corresponding contract address before run.

Double check the value of `poolAddr`, `zapAddr` and `poolIndex` through test script with same farm name:

`poolAddr` = `curvePoolAddr` in test script

`zapAddr` = `curvePoolZap` in test script

`poolIndex` = `poolIndex` in test script

```
npx hardhat run --network mainnet scripts/deploy/usd/products/alusd.js
```

Verify earnVault:

```
npx hardhat run --network mainnet scripts/verify/usd/base/earnVault.js
```

> earnVault verification only need run once.

Then, go to [Etherscan](https://etherscan.io/), search earnVault proxy contract address for each farm, click *Code*, click *More Options* -> *Is this a proxy?*, click *Verify*, check if implementation contract is same as `earnVaultAddr` in `earnVault.js`, then proceed with the verification. After success verify, there will be 2 new button, *Read as Proxy* & *Write as Proxy*, in the same row of *Code*, *Read Contract* & *Write Contract*.

3/ Transfer ownership

All contracts can be transfer to multi-sig via `transferOwnership()` through Etherscan, except proxy admin of DAO Earn Vaults. The process of transferring proxy admin can be done only through code, and after transferring proxy admin, there will be some troublesome to upgrade implementation contract. Since user can't see the owner of proxy admin through Etherscan, let's stick it to the deployer first.

## Kovan contract addresses

These contracts use as interface for all USD series product. In Mainnet each product will have different contract address.

EarnVault proxy: 0x47bb78583fea8Ab0F1D8cA94750fe4C266fFb8F1

CurveZap: 0x032C77879F47C6f2617AB7b31626a003c73C5127

EarnStrategyFactory: 0xebcC9b9B4239670fb384C82e97A61B7469d97A12

EarnStrategyTemplate: 0x41240a6207E1FCCD5A209112137c08001982583E

AnyToken "ATN": 0xBB06dF04f0D508FC4b1bdBbf164d82884C5F677A

USDT: 0x07de306FF27a2B630B1141956844eB1552B956B5

USDC: 0xb7a4F3E9097C08dA09517b5aB877F7a917224ede

DAI: 0x4F96Fe3b7A6Cf9725f59d353F723c1bDb64CA6Aa

> In Kovan, vault contract accept ATN only. Zap contract accept USDT/USDC/DAI, ATN(`depositZap()`) and ETH(`depositZap()`) only.


# DAO Earn Series (BTC based - 6 products)

### Deposit token:-

Product Name | Available token to deposit
--------- | --------------------------
BBTC | [WBTC](https://etherscan.io/address/0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599)/[renBTC](https://etherscan.io/address/0xEB4C2781e4ebA804CE9a9803C67d0893436bB27D)/[sBTC](https://etherscan.io/address/0xfE18be6b3Bd88A2D2A7f928d00292E7a9963CfC6)/[BBTC](https://etherscan.io/address/0x9BE89D2a4cd102D8Fecc6BF9dA793be995C22541)/*[LP Token](https://etherscan.io/address/0x410e3E86ef427e30B9235497143881f717d93c2A)/[crvRenWSBTC](https://etherscan.io/address/0x075b1bb99792c9E1041bA13afEf80C91a1e70fB3)/**any token/directly from ETH
PBTC | WBTC/renBTC/sBTC/[PBTC](https://etherscan.io/address/0x5228a22e72ccC52d415EcFd199F99D0665E7733b)/*[LP Token](https://etherscan.io/address/0xDE5331AC4B3630f94853Ff322B66407e0D6331E8)/crvRenWSBTC/**any token/directly from ETH
OBTC | WBTC/renBTC/sBTC/[OBTC](https://etherscan.io/address/0x8064d9Ae6cDf087b1bcd5BDf3531bD5d8C537a68)/*[LP Token](https://etherscan.io/address/0x2fE94ea3d5d4a175184081439753DE15AeF9d614)/crvRenWSBTC/**any token/directly from ETH
TBTC | WBTC/renBTC/sBTC/[TBTC](https://etherscan.io/address/0x8dAEBADE922dF735c38C80C7eBD708Af50815fAa)/*[LP Token](https://etherscan.io/address/0x64eda51d3Ad40D56b9dFc5554E06F94e1Dd786Fd)/crvRenWSBTC/**any token/directly from ETH
sBTC | WBTC/renBTC/sBTC/*[LP Token](https://etherscan.io/address/0x075b1bb99792c9E1041bA13afEf80C91a1e70fB3)/**any token/directly from ETH
HBTC | WBTC/[HBTC](https://etherscan.io/address/0x0316EB71485b0Ab14103307bf65a021042c6d380)/*[LP Token](https://etherscan.io/address/0xb19059ebb43466C323583928285a49f558E572Fd)/**any token/directly from ETH

*Deposit LP token for no slippage & fees by Curve

*any token that available to swap in Sushi.

> IMPORTANT: WBTC, renBTC & BBTC are 8 decimals. Others are 18 decimals.

### Withdraw token:-

Product Name | Available token to withdraw
--------- | --------------------------
BBTC | [WBTC](https://etherscan.io/address/0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599)/[renBTC](https://etherscan.io/address/0xEB4C2781e4ebA804CE9a9803C67d0893436bB27D)/[sBTC](https://etherscan.io/address/0xfE18be6b3Bd88A2D2A7f928d00292E7a9963CfC6)/[BBTC](https://etherscan.io/address/0x9BE89D2a4cd102D8Fecc6BF9dA793be995C22541)/*[LP Token](https://etherscan.io/address/0x410e3E86ef427e30B9235497143881f717d93c2A)
PBTC | WBTC/renBTC/sBTC/[PBTC](https://etherscan.io/address/0x5228a22e72ccC52d415EcFd199F99D0665E7733b)/*[LP Token](https://etherscan.io/address/0xDE5331AC4B3630f94853Ff322B66407e0D6331E8)
OBTC | WBTC/renBTC/sBTC/[OBTC](https://etherscan.io/address/0x8064d9Ae6cDf087b1bcd5BDf3531bD5d8C537a68)/*[LP Token](https://etherscan.io/address/0x2fE94ea3d5d4a175184081439753DE15AeF9d614)
TBTC | WBTC/renBTC/sBTC/[TBTC](https://etherscan.io/address/0x8dAEBADE922dF735c38C80C7eBD708Af50815fAa)/*[LP Token](https://etherscan.io/address/0x64eda51d3Ad40D56b9dFc5554E06F94e1Dd786Fd)
sBTC | WBTC/renBTC/sBTC/*[LP Token](https://etherscan.io/address/0x075b1bb99792c9E1041bA13afEf80C91a1e70fB3)
HBTC | WBTC/[HBTC](https://etherscan.io/address/0x0316EB71485b0Ab14103307bf65a021042c6d380)/*[LP Token](https://etherscan.io/address/0xb19059ebb43466C323583928285a49f558E572Fd)

*Withdraw LP token for no slippage & fees by Curve

# Developer docs

**Frontend** and **Backend** same as USD based products.

**Kovan contract addresses** can reused USD based kovan addresses. Same interaction but different tokens and decimals.

## Deployer

1/ Base contracts

Run script for everything in scripts/deploy/btc/base folder.

Record down every contract address that deployed for later use. (will show with console.log after success deploy)

For each deploy script in deploy/btc/base folder, there is a verify script in verify/btc/base folder with same script name.
```
npx hardhat run --network mainnet scripts/deploy/btc/base/curveMetaPoolBTCZap.js
npx hardhat run --network mainnet scripts/verify/btc/base/curveMetaPoolBTCZap.js
```

2/ Product contracts

Run every script in scripts/deploy/btc/products folder. Fill in `earnStrategyFactoryAddr`, `earnStrategyTemplateAddr` and `curveZapAddr` with corresponding contract address before run.

Double check the value of `poolAddr`, `zapAddr` and `poolIndex` through test script with same farm name:

`poolAddr` = `curvePoolAddr` in test script

`zapAddr` = `curvePoolZap` in test script

`poolIndex` = `poolIndex` in test script

```
npx hardhat run --network mainnet scripts/deploy/btc/products/bbtc.js
```

Verify earnVaultBTC:

```
npx hardhat run --network mainnet scripts/verify/btc/base/earnVaultBTC.js
```

> earnVaultBTC verification only need run once.

Then, go to [Etherscan](https://etherscan.io/), search earnVaultBTC proxy contract address for each farm, click *Code*, click *More Options* -> *Is this a proxy?*, click *Verify*, check if implementation contract is same as `earnVaultAddr` in `earnVaultBTC.js`, then proceed with the verification. After success verify, there will be 2 new button, *Read as Proxy* & *Write as Proxy*, in the same row of *Code*, *Read Contract* & *Write Contract*.

3/ Transfer ownership

Same as USD based products.